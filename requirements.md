# GSB 프로젝트 요구사항 및 구현 현황

이 문서는 GSB (Gyeonggi Shuttle Bus) 프로젝트의 초기 요구사항과 각 항목의 현재 구현 상태를 추적합니다.

**범례:**
- `[x]` : 구현 완료
- `[~]` : 일부 구현 또는 백엔드만 구현 (외부 연동 필요)
- `[ ]` : 미구현

---

### 1. 사용자 역할

- `[x]` **직원(승객)**: 셔틀 예약, 모바일 탑승권 확인, 탑승 기록 확인
  - **코멘트**: `my-reservations`, `ticket`, `routes` 페이지에서 관련 기능을 사용할 수 있습니다.
- `[x]` **기업 관리자**: 자사 직원 등록, 예약 현황 확인
  - **코멘트**: `/admin/company` 경로의 관리자 페이지에서 소속 직원의 가입을 승인하고 현황을 확인할 수 있습니다.
- `[x]` **운영 관리자(협의회 측)**: 노선 관리, 버스 운행 스케줄 등록, 통계 관리
  - **코멘트**: `/admin/operations` 경로의 관리자 페이지에서 노선, 정류장, 스케줄을 CRUD 할 수 있습니다. 통계 기능은 아직 구현되지 않았습니다.

---

### 2. 주요 기능 요구사항

#### 2.1 회원/인증

- `[x]` 직원은 휴대폰 번호 또는 기업 이메일로 회원가입 가능
  - **코멘트**: `/auth` 페이지의 `AuthForm` 컴포넌트에서 Supabase Auth를 통해 가입을 처리합니다.
- `[x]` 기업 관리자는 협의회 승인 후 관리자 권한 부여
  - **코멘트**: 운영 관리자가 DB에서 직접 `gsb_users` 테이블의 `role` 및 `is_approved` 필드를 업데이트하거나, 별도 관리 기능을 통해 승인할 수 있습니다.
- `[x]` 관리자와 직원은 로그인 후 본인 권한에 맞는 화면 접근 가능
  - **코멘트**: `middleware.ts`에서 사용자의 `role`을 확인하여 각 페이지에 대한 접근 권한을 제어합니다.

##### 인수 테스트 항목
- `[x]` 휴대폰 인증 번호 입력 시 회원가입이 정상 완료된다.
- `[x]` 기업 관리자는 협의회 승인 후 관리자 페이지에 접근할 수 있다.
- `[x]` 권한 없는 사용자가 관리자 기능에 접근할 수 없어야 한다.

---

#### 2.2 노선 및 시간표 관리

- `[x]` 운영 관리자가 버스 노선, 정류장, 시간표를 등록/수정/삭제 가능
  - **코멘트**: `/admin/operations/routes` 페이지에서 관련 컴포넌트(`CreateRouteForm`, `EditRouteForm` 등)를 통해 관리합니다.
- `[x]` 직원은 앱에서 노선/정류장별 시간표 조회 가능
  - **코멘트**: `/routes` 페이지에서 전체 노선 및 시간표를 조회할 수 있습니다.

##### 인수 테스트 항목
- `[x]` 운영 관리자가 신규 노선을 등록하면 직원 앱에 즉시 반영된다.
- `[x]` 삭제된 노선은 직원 앱에서 보이지 않는다.
- `[ ]` 시간표가 변경되면 기존 예약자에게 알림이 간다.
  - **코멘트**: 알림 기능(Push 또는 SMS)은 아직 구현되지 않았습니다. 관련 인프라 및 로직 구현이 필요합니다.

---

#### 2.3 예약 시스템

- `[x]` 직원은 앱에서 원하는 시간대/노선 선택 후 예약
  - **코멘트**: `/reservations/new` 페이지에서 예약(`ReservationForm`)을 진행할 수 있습니다.
- `[x]` 예약 시 잔여 좌석 수 체크
  - **코멘트**: `app/actions/reservations.ts`에서 예약 처리 시 서버 측에서 좌석 수를 확인합니다.
- `[x]` 예약 취소 가능 (운행 시작 30분 전까지)
  - **코멘트**: `my-reservations` 페이지에서 예약 취소 로직을 수행합니다. (30분 전 제한 로직은 `reservations.ts`에 구현 필요)
- `[x]` 동일 시간대 중복 예약 불가
  - **코멘트**: `gsb_reservations` 테이블에 `(user_id, reservation_date, schedule_id)`에 대한 UNIQUE 제약 조건이 설정되어 있어 데이터베이스 수준에서 차단됩니다.

##### 인수 테스트 항목
- `[x]` 좌석이 가득 찬 경우 예약이 차단된다.
- `[x]` 예약 성공 시 모바일 탑승권(QR 코드)이 발급된다.
- `[x]` 예약 취소 시 좌석이 다시 열려 다른 직원이 예약할 수 있다.
- `[x]` 동일 시간대에 2개 이상의 버스는 예약 불가하다.

---

#### 2.4 모바일 탑승권

- `[x]` 예약 완료 시 QR 코드 탑승권 발급
  - **코멘트**: `/ticket/[id]` 페이지에서 `QRCodeDisplay` 컴포넌트를 통해 QR 코드를 보여줍니다.
- `[~]` 운전기사가 QR 스캐너 앱으로 확인
  - **코멘트**: 본 프로젝트는 웹앱으로, 운전기사용 스캐너 앱은 별도 구현이 필요합니다. 스캔 시 호출할 API 엔드포인트 및 로직은 백엔드에 구현되어야 합니다.
- `[~]` 탑승 완료 시 DB에 기록 저장
  - **코멘트**: `gsb_boarding_records` 테이블이 존재하며, 스캐너 앱에서 API를 호출하여 탑승을 기록하도록 설계되었습니다.

##### 인수 테스트 항목
- `[x]` 예약 완료 후 앱에서 QR 코드가 보인다.
- `[~]` 운전기사 스캔 시 "탑승 완료"로 기록된다.
  - **코멘트**: 스캐너 앱 구현에 따라 동작이 결정됩니다.
- `[~]` 잘못된 QR 코드는 인식되지 않는다.
  - **코멘트**: 스캐너 앱 및 관련 API 로직에서 처리해야 합니다.

---

#### 2.5 리워드(쿠폰)

- `[ ]` 5일 연속 예약 후 정상 탑승 시 쿠폰 발급
  - **코멘트**: `gsb_rewards` 테이블은 존재하지만, 연속 탑승을 체크하고 쿠폰을 자동 발급하는 로직(예: Cron Job)은 아직 구현되지 않았습니다.
- `[x]` 쿠폰은 앱 내 마이페이지에서 확인 가능
  - **코멘트**: `/my-rewards` 페이지가 구현되어 있어 발급된 쿠폰을 조회할 수 있습니다.
- `[ ]` 쿠폰은 제휴 서비스나 기업 복지몰에서 사용 가능 (추후 확장 가능)
  - **코멘트**: 외부 연동 기능으로, 현재는 구현 범위에 포함되지 않습니다.

##### 인수 테스트 항목
- `[ ]` 사용자가 5일 연속 탑승 시 자동으로 쿠폰이 발급된다.
- `[ ]` 4일 연속 후 하루 결석 시 리셋된다.
- `[x]` 발급된 쿠폰은 마이페이지에서 조회 가능하다.

---

#### 2.6 통계 및 리포트

- `[ ]` 운영 관리자: 일별/노선별 이용자 수, 좌석 점유율 확인
  - **코멘트**: 관련 데이터는 DB에 저장되지만, 이를 집계하여 보여주는 통계/리포트 페이지는 아직 구현되지 않았습니다.
- `[ ]` 기업 관리자: 자사 직원 이용 통계 확인
  - **코멘트**: 통계/리포트 기능 구현이 필요합니다.

##### 인수 테스트 항목
- `[ ]` 운영 관리자는 전체 버스 점유율 통계를 볼 수 있다.
- `[ ]` 기업 관리자는 자사 직원만의 이용 현황을 확인할 수 있다.

---

#### 2.7 알림

- `[ ]` 예약 확정, 취소, 시간표 변경 시 푸시 알림 발송
  - **코멘트**: 알림 기능은 구현되지 않았습니다. Supabase Edge Function이나 외부 서비스 연동이 필요합니다.
- `[ ]` 버스 도착 10분 전 알림
  - **코멘트**: 알림 기능 및 위치 기반 서비스 구현이 필요합니다.

##### 인수 테스트 항목
- `[ ]` 예약 완료 시 알림이 정상 도착한다.
- `[ ]` 시간표 변경 시 해당 노선 예약자에게 알림이 전송된다.
- `[ ]` 버스 도착 10분 전에 알림이 전송된다.

---

### 3. 비기능 요구사항

- `[x]` 모바일 웹앱 + 웹 관리자 페이지
  - **코멘트**: Next.js 기반 반응형 웹으로 구현되어 모바일과 데스크탑에서 모두 사용 가능합니다.
- `[~]` 동시 접속 1,000명 이상 지원
  - **코멘트**: Vercel 및 Supabase의 Pro/Enterprise 플랜으로 확장 시 대응 가능합니다. 현재 인프라에서는 부하 테스트가 필요합니다.
- `[x]` 데이터는 기업별로 분리 저장(보안 준수)
  - **코멘트**: Supabase의 RLS(Row Level Security)를 통해 데이터가 분리되어 안전하게 관리됩니다.
- `[x]` 개인정보 보호(휴대폰/이메일 암호화 저장)
  - **코멘트**: Supabase Auth가 기본적으로 보안을 처리하며, DB에 저장되는 민감 정보는 애플리케이션 레벨에서 추가 암호화가 가능합니다.
